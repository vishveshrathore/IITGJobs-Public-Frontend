import{u as te,b as se,a as o,j as e,m as j,F as ae,c as $}from"./index-C63xejpN.js";import{B as v}from"./config-BngW1GPq.js";const ne=()=>{const K=te(),{getUser:U}=se(),r=U()?.email||"",[B,u]=o.useState(!1),[M,k]=o.useState(""),[h,Z]=o.useState([]),[G,I]=o.useState(!1),[n,R]=o.useState(""),[b,H]=o.useState(""),[N,A]=o.useState(!1),[w,V]=o.useState(!1),[z,p]=o.useState(!1),[q,Y]=o.useState(!1),[E,c]=o.useState(""),[J,P]=o.useState(!1),[T,L]=o.useState(""),[O,D]=o.useState([]),[g,F]=o.useState(null),[S,Q]=o.useState(!1);o.useEffect(()=>{(async()=>{I(!0);try{const{data:s}=await $.get(`${v}/api/recruitment/getCompanies/all`);Z(Array.isArray(s?.data)?s.data:[])}catch(s){c(s?.response?.data?.message||s?.message||"Failed to load companies")}finally{I(!1)}})()},[]),o.useEffect(()=>{if(!r){p(!1);return}const t=`public_access_verified_global:${r}`;if(localStorage.getItem(t)==="1"){p(!0),Y(!0),c("Already verified.");const l=`public_access_last_company:${r}`,a=localStorage.getItem(l);a&&R(a);return}if(n){const l=`public_access_verified:${r}:${n}`,a=localStorage.getItem(l);p(a==="1"),a==="1"&&c("Already verified for this company.")}else p(!1)},[r,n]);const C=async(t,s,l)=>{try{P(!0),L(""),D([]);const a=`${v}/api/recruitment`;let i="";t==="demo"?i=`${a}/parsed-profiles/top-ctc?companyId=${encodeURIComponent(s)}${l?`&companyName=${encodeURIComponent(l)}`:""}`:i=`${a}/parsed-profiles/all-alpha?companyId=${encodeURIComponent(s)}${l?`&companyName=${encodeURIComponent(l)}`:""}`;const m=await fetch(i,{credentials:"include"}),x=await m.json().catch(()=>({}));if(!m.ok||x?.success===!1)throw new Error(x?.message||`Request failed (${m.status})`);const ee=(Array.isArray(x?.data)?x.data:[]).map(d=>({name:d.name||"",designation:d.current_designation||d.designation||"",location:d.location||"",company:d.current_company||d.company||"",date1:d.date1||"",date2:d.date2||"",date3:d.date3||"",date4:d.date4||""}));D(ee)}catch(a){L(a?.message||"Failed to load data")}finally{P(!1)}},y=t=>{const s=String(t||""),l=s.includes("✓"),a=s.toLowerCase().includes("red");return l?e.jsx("span",{className:a?"text-red-400":"text-emerald-400",children:"✓"}):null},f=(t,s=!1)=>{const l=t.includes("/client/demo")?"demo":"service";if(F(l),Q(!!s),z){const a=`public_access_last_company:${r}`,i=n||localStorage.getItem(a);if(i){try{localStorage.setItem(a,i)}catch{}const m=h.find(_=>_._id===i),x=m?.CompanyName||m?.companyName||m?.name||"";C(l,i,x);return}k(t),u(!0);return}k(t),u(!0)},W=async()=>{try{if(A(!0),c(""),!r)throw new Error("No email found in session. Please login.");await $.post(`${v}/api/recruitment/public/send-otp`,{email:r,companyId:n}),c("Submit OTP to see demo data")}catch(t){c(t?.response?.data?.message||t?.message||"Failed to send OTP")}finally{A(!1)}},X=async()=>{try{if(V(!0),c(""),!r)throw new Error("No email found in session. Please login.");const{data:t}=await $.post(`${v}/api/recruitment/public/verify-otp`,{email:r,companyId:n,otp:b});if(t?.success){p(!0),c("Verified! You can access the data now.");try{const s=`public_access_verified:${r}:${n}`;localStorage.setItem(s,"1");const l=`public_access_verified_global:${r}`;localStorage.setItem(l,"1");const a=`public_access_last_company:${r}`;localStorage.setItem(a,n||"")}catch{}if(n){const s=h.find(a=>a._id===n),l=s?.CompanyName||s?.companyName||s?.name||"";setTimeout(()=>{const a=(M||"").includes("/client/demo")?"demo":g||"service";F(a),C(a,n,l),u(!1)},400)}}else c(t?.message||"Failed to verify OTP")}catch(t){c(t?.response?.data?.message||t?.message||"Failed to verify OTP")}finally{V(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-slate-100",children:[e.jsx("div",{className:"sticky top-0 z-10 border-b border-slate-800 bg-slate-900/70 px-4 py-3 backdrop-blur",children:e.jsx("div",{className:"mx-auto flex max-w-6xl items-center justify-between",children:e.jsx("button",{onClick:()=>K("/attrition-grid"),className:"rounded-lg border border-slate-700 px-3 py-1.5 text-sm text-slate-200 hover:bg-slate-800",children:"← Back"})})}),e.jsx(j.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"py-14",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-4 sm:px-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Access Confidential Data"}),e.jsx("p",{className:"mt-2 text-sm text-slate-400",children:"Choose an option to proceed."}),e.jsxs(j.div,{initial:"hidden",whileInView:"show",viewport:{once:!0,amount:.2},className:"mt-8 grid gap-4 sm:grid-cols-2",children:[e.jsxs(j.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.05},whileHover:{y:-3},className:"rounded-xl border border-slate-700 bg-slate-800 p-6 shadow-xl transition hover:border-blue-500",children:[e.jsxs("button",{onClick:()=>f("/client/demo"),className:"flex w-full items-center gap-4 text-left",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg bg-blue-900/40 text-blue-300",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-6 w-6",children:[e.jsx("path",{d:"M2.25 13.5A2.25 2.25 0 0 1 4.5 11.25h15a2.25 2.25 0 0 1 2.25 2.25v4.125A2.625 2.625 0 0 1 19.125 20.25H4.875A2.625 2.625 0 0 1 2.25 17.625V13.5Z"}),e.jsx("path",{d:"M8.25 7.125C8.25 6.089 9.089 5.25 10.125 5.25h3.75c1.036 0 1.875.839 1.875 1.875V9h-7.5V7.125Z"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:"Demo"}),e.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Report of Last 24 hours"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>f("/client/demo",!0),className:"px-3 py-1.5 text-xs rounded border border-blue-600 bg-blue-600 text-white hover:bg-blue-500",children:"Get Report"})})]}),e.jsxs(j.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.12},whileHover:{y:-3},className:"rounded-xl border border-slate-700 bg-slate-800 p-6 shadow-xl transition hover:border-emerald-500",children:[e.jsxs("button",{onClick:()=>f("/client/service"),className:"flex w-full items-center gap-4 text-left",children:[e.jsx("div",{className:"flex h-12 w-15 items-center justify-center rounded-lg bg-emerald-900/40 text-emerald-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-6 w-6",children:e.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75S6.615 21.75 12 21.75 21.75 17.385 21.75 12 17.385 2.25 12 2.25Zm.75 14.25a.75.75 0 0 1-1.5 0v-1.5a.75.75 0 0 1 1.5 0v1.5ZM12 6a3.75 3.75 0 0 0-3.75 3.75.75.75 0 0 0 1.5 0A2.25 2.25 0 1 1 12 12a.75.75 0 0 0-.75.75v.375a.75.75 0 0 0 1.5 0v-.085A3.75 3.75 0 0 0 12 6Z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:"Service"}),e.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Report of Last one week"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>f("/client/service",!0),className:"px-3 py-1.5 text-xs rounded border border-emerald-600 bg-emerald-600 text-white hover:bg-emerald-500",children:"Get Report"})})]})]})]})}),B&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:[" ",e.jsxs("div",{className:"w-full max-w-lg rounded-lg bg-slate-800 p-6 shadow-2xl text-slate-100 border border-slate-700",children:[" ",e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Select Company & Verify Email"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"Choose your company and verify via OTP to access Demo/Service."}),e.jsxs("div",{className:"mt-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 text-slate-300",children:"Company"}),e.jsxs("select",{value:n,onChange:t=>R(t.target.value),className:"w-full text-sm px-3 py-2 rounded border border-slate-600 bg-slate-900 text-slate-200 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",disabled:!0,className:"bg-slate-700",children:G?"Loading companies…":"Select a company"}),h.map(t=>e.jsx("option",{value:t._id,className:"bg-slate-700",children:t.CompanyName||t.companyName||t.name||"Unnamed Company"},t._id))]})]}),!q&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:W,disabled:!n||!r||N,className:`text-sm px-3 py-2 rounded transition-colors ${!n||!r||N?"bg-blue-800/60 cursor-not-allowed text-slate-400":"bg-blue-600 hover:bg-blue-500 text-white"}`,children:N?"Sending…":"Send OTP"}),e.jsx("input",{type:"text",value:b,onChange:t=>H(t.target.value),placeholder:"Enter OTP",className:"flex-1 text-sm px-3 py-2 rounded border border-slate-600 bg-slate-900 text-slate-200 placeholder-slate-500 focus:ring-emerald-500 focus:border-emerald-500"}),e.jsx("button",{onClick:X,disabled:!b||!n||!r||w,className:`text-sm px-3 py-2 rounded transition-colors ${!b||!n||!r||w?"bg-emerald-800/60 cursor-not-allowed text-slate-400":"bg-emerald-600 hover:bg-emerald-500 text-white"}`,children:w?"Submitting...":"Submit"})]}),E&&e.jsx("div",{className:"text-xs text-slate-400",children:E})]}),e.jsx("div",{className:"mt-5 flex justify-end gap-2",children:e.jsx("button",{onClick:()=>u(!1),className:"px-3 py-2 text-sm rounded border border-slate-600 bg-slate-700 hover:bg-slate-600 text-slate-200",children:"Close"})})]})]}),e.jsx("div",{className:"mx-auto max-w-6xl px-4 sm:px-6 pb-10",children:g&&e.jsxs("div",{className:"mt-6 rounded-xl border border-slate-700 bg-slate-800 p-4 shadow-xl",children:[" ",e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-200",children:g==="demo"?"":"All Profiles (Service)"}),e.jsx("button",{onClick:()=>{const t=`public_access_last_company:${r}`,s=n||localStorage.getItem(t),l=h.find(i=>i._id===s),a=l?.CompanyName||l?.companyName||l?.name||"";s&&C(g,s,a)},className:"rounded border border-slate-700 px-2 py-1 text-xs text-slate-300 hover:bg-slate-700",children:"Refresh"})]}),T&&e.jsx("div",{className:"mb-2 rounded border border-red-700 bg-red-900/30 p-2 text-sm text-red-300",children:T}),J?e.jsx("div",{className:"py-6 text-sm text-slate-400",children:"Loading…"}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-700",children:e.jsxs("table",{className:"min-w-full text-left text-sm",children:[e.jsxs("thead",{className:"bg-slate-900 border-b border-slate-700",children:[" ",e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"Designation"}),e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"Location"}),e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"Company"}),S&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"06/09/2025"}),e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"13/09/2025"}),e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"20/09/2025"}),e.jsx("th",{className:"px-4 py-3 text-gray-200",children:"27/09/2025"})]})]})]}),e.jsx("tbody",{children:O.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:S?8:4,className:"px-4 py-4 text-center text-gray-500 bg-slate-800",children:"No data available."})}):O.map((t,s)=>e.jsxs("tr",{className:`border-b border-slate-700 ${s%2===0?"bg-slate-800 hover:bg-slate-700":"bg-slate-900 hover:bg-slate-800"} transition-colors`,children:[e.jsx("td",{className:"px-4 py-2 text-gray-300",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-gray-300",children:t.designation}),e.jsx("td",{className:"px-4 py-2 text-gray-300",children:t.location}),e.jsx("td",{className:"px-4 py-2 text-gray-300",children:t.company}),S&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2 text-gray-300",children:y(t.date1)}),e.jsx("td",{className:"px-4 py-2 text-gray-300",children:y(t.date2)}),e.jsx("td",{className:"px-4 py-2 text-gray-300",children:y(t.date3)}),e.jsx("td",{className:"px-4 py-2 text-gray-300",children:y(t.date4)})]})]},s))})]})})]})}),e.jsx(ae,{})]})};export{ne as default};
